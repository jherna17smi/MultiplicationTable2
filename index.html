<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Antonio Multiplication Table Practice App</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --lavender:#efe6ff;
      --brand-blue:#0d6efd;
      --brand-red:#dc3545;
      --answered:#e7f5ff;
    }
    body{ background: var(--lavender); }

    /* Blue & red landing bar */
    .hero{
      background: linear-gradient(90deg,var(--brand-blue),var(--brand-red));
      color:#fff;
      padding: 2.25rem 1rem;
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }

    .explain p { margin-bottom: .5rem; }
    .explain ul, .explain ol { margin-bottom: .5rem; }

    /* Flashcards */
    .card-3d{
      perspective: 1000px;
      height: 220px;
      cursor: default;
      position: relative;
    }
    .card-3d-inner{
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .card-3d.flipped .card-3d-inner{ transform: rotateY(180deg); }

    .card-face{
      position: absolute; inset:0;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden; /* Safari */
      border-radius: 1rem;
      border: 1px solid rgba(0,0,0,.075);
      background: #fff;
      display: flex; align-items: center; justify-content:center;
      padding: 1rem; text-align:center;
      box-shadow: 0 6px 20px rgba(0,0,0,.08);
    }
    .card-back{ transform: rotateY(180deg); }

    .q-big{ font-size: clamp(1.25rem, 3vw, 1.8rem); font-weight:700; }
    .ans-big{ font-size: clamp(1.25rem, 3vw, 1.8rem); font-weight:700; color: var(--brand-blue); }

    /* Hover animation used by multiple buttons */
    @keyframes floaty {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }

    /* Hovering flip button under the question */
    .floating-btn{
      margin-top: 1rem;
      animation: floaty 2.2s ease-in-out infinite;
      transition: transform .15s ease;
    }
    .floating-btn:hover{ transform: translateY(-2px) scale(1.03); }

    /* Floating style for flip-side buttons */
    .back-btn{
      animation: floaty 2.2s ease-in-out infinite;
      transition: transform .15s ease;
    }
    .back-btn:hover{ transform: translateY(-2px) scale(1.03); }

    /* Mark answered cards subtly */
    .answered .card-face{ background: var(--answered); }

    /* Fireworks full-screen canvas */
    #fw-canvas{
      position: fixed; inset: 0;
      pointer-events: none;
      display: none;
      z-index: 9999;
    }

    /* Print tweaks */
    @media print{
      #fw-canvas, .hero, #controls, #apiRow { display:none !important; }
      .container{ max-width: 100% !important; }
      .card-3d{ page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <canvas id="fw-canvas"></canvas>

  <header class="hero">
    <div class="container">
      <h1 class="display-6 fw-bold mb-2">Antonio Multiplication Table Practice App</h1>
      <p class="mb-0">Practice tables (1â€“12) with flip cards, score &amp; high score, printable results, and colorful fireworks!</p>
    </div>
  </header>

  <main class="container my-4">
    <!-- Kid-friendly explanation + how the app works -->
    <section class="explain bg-white p-3 p-md-4 rounded-4 shadow-sm mb-4">
      <h2 class="h4">How to Multiply (Kid-Friendly!)</h2>
      <ul>
        <li><strong>Multiplication</strong> is repeated addition: <strong>3 Ã— 4</strong> means <em>4 + 4 + 4 = 12</em>.</li>
        <li>Order doesnâ€™t change the answer: <strong>3 Ã— 4 = 4 Ã— 3</strong> (commutative property).</li>
        <li>Break apart to make it easier: <strong>7 Ã— 6 = 7 Ã— (3 + 3) = 21 + 21 = 42</strong>.</li>
        <li>Use patterns &amp; skip-counting (5s: 5,10,15,20â€¦ â€¢ 9s trick â€¢ 11s pattern).</li>
      </ul>
      <h3 class="h6 mt-3">How this app works</h3>
      <ol class="mb-0">
        <li>You get <strong>10</strong> random multiplication questions as flip cards.</li>
        <li>Press the <strong>hover</strong> button on a card to flip and see the answer.</li>
        <li>Mark yourself <em>I was correct</em> or <em>I need help</em> to track your score.</li>
        <li>At the end, see your <strong>score</strong>, persistent <strong>high score</strong>, and explanations for any misses.</li>
        <li>Use the <strong>API placeholders</strong> or <strong>Generate 10 New Cards</strong> for a new set.</li>
        <li>Get a perfect 10 to unlock a full-screen <strong>fireworks</strong> show! ðŸŽ†</li>
        <li>Use <strong>Print Results</strong> to print your score and explanations.</li>
      </ol>
    </section>

    <!-- Controls -->
    <section id="controls" class="d-flex flex-wrap gap-2 align-items-center mb-3">
      <button id="regenBtn" class="btn btn-primary">Generate 10 New Cards</button>

      <!-- Placeholder API buttons (simulate fetching from APIs) -->
      <button id="apiBtnA" class="btn btn-danger">API A: New Questions</button>
      <button id="apiBtnB" class="btn btn-warning">API B: New Questions</button>

      <button id="printBtn" class="btn btn-outline-secondary">Print Results &amp; Explanations</button>

      <div class="ms-auto d-flex align-items-center gap-2">
        <span class="badge text-bg-success" id="scoreBadge" aria-live="polite">Score: 0/10</span>
        <span class="badge text-bg-info" id="highBadge">High: 0/10</span>
      </div>
    </section>

    <!-- Flashcards Grid -->
    <section id="cardsRow" class="row g-3"></section>

    <!-- Results & explanations -->
    <section id="results" class="bg-white p-3 p-md-4 rounded-4 shadow-sm mt-4" style="display:none;">
      <h3 class="h5 mb-3">Your Results</h3>
      <p id="scoreLine" class="mb-2"></p>
      <div id="explanations" class="mb-3"></div>
      <button id="playAgainBtn" class="btn btn-success">Play Again</button>
    </section>

    <!-- API row info -->
    <section id="apiRow" class="mt-4" style="display:none;">
      <div class="alert alert-info">Loaded a fresh set of questions from a placeholder API.</div>
    </section>

    <!-- Multiplication Tables (1 to 12) -->
    <section class="bg-white p-3 p-md-4 rounded-4 shadow-sm mt-4">
      <h2 class="h5 mb-3">Multiplication Tables (1â€“12)</h2>
      <div id="tables" class="row g-3"></div>
    </section>
  </main>

  <footer class="py-4 text-center text-muted">
    Â© Jose A. Hernandez Soto â€” Front End Developer â€” All rights reserved.
  </footer>

  <script>
    /* =========================
       Utility: random questions
       ========================= */
    function makeQuestion(min=1, max=12){
      const a = Math.floor(Math.random()*(max-min+1))+min;
      const b = Math.floor(Math.random()*(max-min+1))+min;
      return { a, b, answer: a*b, text: `${a} Ã— ${b}` };
    }
    function makeTen(){ return Array.from({length:10}, ()=> makeQuestion()); }

    /* =========================
       Explanations
       ========================= */
    function explain(q){
      const {a,b,answer} = q;
      const style = Math.floor(Math.random()*3);
      if(style===0){
        return a + " x " + b + " means " + a + " groups of " + b + ": " + Array(a).fill(b).join(" + ") + " = " + answer + ".";
      }else if(style===1){
        const small = Math.min(a,b);
        return `Order doesnâ€™t matter: ${a} Ã— ${b} = ${b} Ã— ${a}. Skip-count by ${small} to reach ${answer}.`;
      }else{
        const x = Math.floor(b/2);
        const y = b - x;
        return `Break apart ${b} into ${x} + ${y}: ${a}Ã—${b} = ${a}Ã—${x} + ${a}Ã—${y} = ${a*x} + ${a*y} = ${answer}.`;
      }
    }

    /* =========================
       Fireworks (simple particles)
       ========================= */
    const fwCanvas = document.getElementById('fw-canvas');
    const fctx = fwCanvas.getContext('2d');
    let fwActive = false, particles = [], rafId = null;

    function resizeFW(){
      fwCanvas.width = window.innerWidth;
      fwCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', ()=>{ if(fwActive) resizeFW(); });

    function launchFireworks(){
      resizeFW();
      fwCanvas.style.display = 'block';
      fwActive = true;
      particles = [];
      const colors = ['#ff4d4d','#ffd24d','#4dff88','#4dd2ff','#b84dff'];
      for(let i=0;i<12;i++){
        const cx = Math.random()*fwCanvas.width;
        const cy = Math.random()*fwCanvas.height*0.6;
        const count = 60;
        for(let j=0;j<count;j++){
          const angle = (Math.PI*2)*(j/count);
          const speed = 2 + Math.random()*4;
          particles.push({
            x: cx, y: cy,
            vx: Math.cos(angle)*speed,
            vy: Math.sin(angle)*speed,
            life: 60 + Math.random()*30,
            color: colors[(i+j)%colors.length]
          });
        }
      }
      animateFW();
      setTimeout(stopFireworks, 3200);
    }
    function animateFW(){
      if(!fwActive) return;
      fctx.clearRect(0,0,fwCanvas.width, fwCanvas.height);
      for(const p of particles){
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.03; // gravity
        p.life -= 1;
        fctx.globalAlpha = Math.max(p.life/90, 0);
        fctx.fillStyle = p.color;
        fctx.beginPath();
        fctx.arc(p.x,p.y,2,0,Math.PI*2);
        fctx.fill();
      }
      particles = particles.filter(p => p.life>0);
      rafId = requestAnimationFrame(animateFW);
    }
    function stopFireworks(){
      fwActive = false;
      if(rafId) cancelAnimationFrame(rafId);
      fwCanvas.style.display = 'none';
    }

    /* =========================
       State & DOM refs
       ========================= */
    const cardsRow = document.getElementById('cardsRow');
    const scoreBadge = document.getElementById('scoreBadge');
    const highBadge  = document.getElementById('highBadge');
    const results = document.getElementById('results');
    const scoreLine = document.getElementById('scoreLine');
    const explanationsBox = document.getElementById('explanations');
    const apiRow = document.getElementById('apiRow');

    let questions = [];
    let revealed = Array(10).fill(false);
    let correct = 0;
    let finished = false;
    let wrongs = [];

    /* =========================
       High score (localStorage)
       ========================= */
    const HS_KEY = 'mt_high_score';
    function getHighScore(){
      const raw = localStorage.getItem(HS_KEY);
      const n = raw ? parseInt(raw,10) : 0;
      return isNaN(n) ? 0 : n;
    }
    function setHighScore(n){
      localStorage.setItem(HS_KEY, String(n));
    }
    function refreshHighBadge(){
      highBadge.textContent = `High: ${getHighScore()}/10`;
    }

    /* =========================
       Score handling
       ========================= */
    function updateScore(){
      scoreBadge.textContent = `Score: ${correct}/10`;
    }

    function finishIfDone(){
      const allMarked = revealed.every(Boolean);
      if(allMarked && !finished){
        finished = true;
        results.style.display = 'block';
        scoreLine.textContent = (correct===10)
          ? `Perfect! You got all 10 correct.`
          : `You got ${correct} out of 10 correct.`;

        // High score update
        const hs = getHighScore();
        if(correct > hs){ setHighScore(correct); }
        refreshHighBadge();

        explanationsBox.innerHTML = "";
        if(wrongs.length){
          const list = document.createElement('ol');
          wrongs.forEach(w => {
            const li = document.createElement('li');
            li.className = 'mb-2';
            li.innerHTML = `<strong>${w.text} = ${w.answer}</strong><br><small>${explain(w)}</small>`;
            list.appendChild(li);
          });
          const lead = document.createElement('p');
          lead.innerHTML = "<strong>How to fix the ones you missed:</strong>";
          explanationsBox.appendChild(lead);
          explanationsBox.appendChild(list);
        }else{
          const p = document.createElement('p');
          p.textContent = "Amazing work! Nothing to review ðŸŽ‰";
          explanationsBox.appendChild(p);
          launchFireworks();
        }
        window.scrollTo({top: results.offsetTop - 80, behavior:'smooth'});
      }
    }

    /* =========================
       Card rendering
       ========================= */
    function renderCards(){
      cardsRow.innerHTML = '';
      results.style.display = 'none';
      apiRow.style.display = 'none';
      correct = 0; revealed = Array(10).fill(false); wrongs = []; finished = false;
      updateScore();

      questions.forEach((q, idx)=>{
        const col = document.createElement('div');
        col.className = 'col-12 col-sm-6 col-lg-4';

        const shell = document.createElement('div');
        shell.className = 'card-3d';
        shell.setAttribute('data-idx', idx);

        const inner = document.createElement('div');
        inner.className = 'card-3d-inner';

        // FRONT
        const front = document.createElement('div');
        front.className = 'card-face card-front d-flex flex-column justify-content-center';

        const qText = document.createElement('div');
        qText.className = 'q-big';
        qText.textContent = `Q${idx+1}: ${q.text} = ?`;

        const btn = document.createElement('button');
        btn.className = 'btn btn-outline-dark floating-btn';
        btn.textContent = 'Click me for the answers';
        btn.setAttribute('aria-label','Flip card to see the answer');
        btn.title = 'Flip to see the answer';
        btn.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          shell.classList.add('flipped');
        });

        front.append(qText, btn);

        // BACK
        const back = document.createElement('div');
        back.className = 'card-face card-back d-flex flex-column';

        const ans = document.createElement('div');
        ans.className = 'ans-big mb-2';
        ans.textContent = `${q.text} = ${q.answer}`;

        const explainSmall = document.createElement('small');
        explainSmall.className = 'text-muted';
        explainSmall.textContent = 'Mark yourself: did you get it right?';

        const btnRow = document.createElement('div');
        btnRow.className = 'd-flex gap-2 justify-content-center mt-2';

        const rightBtn = document.createElement('button');
        rightBtn.className = 'btn btn-success btn-sm back-btn';
        rightBtn.textContent = 'I was correct';

        const wrongBtn = document.createElement('button');
        wrongBtn.className = 'btn btn-danger btn-sm back-btn';
        wrongBtn.textContent = "I need help";

        const flipBackBtn = document.createElement('button');
        flipBackBtn.className = 'btn btn-outline-secondary btn-sm';
        flipBackBtn.textContent = 'Flip back';
        flipBackBtn.title = 'Flip back to the question';
        flipBackBtn.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          shell.classList.remove('flipped');
        });

        function markAnswered(wasRight){
          if(revealed[idx]) return; // already scored
          revealed[idx] = true;

          // disable buttons so we canâ€™t score twice
          rightBtn.disabled = true;
          wrongBtn.disabled = true;

          // subtle style to show this card is done
          shell.classList.add('answered');

          if(wasRight){
            correct += 1;
            updateScore();
          }else{
            wrongs.push(q);
          }
          finishIfDone();
        }

        rightBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); markAnswered(true); });
        wrongBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); markAnswered(false); });

        btnRow.append(rightBtn, wrongBtn, flipBackBtn);
        back.append(ans, explainSmall, btnRow);

        inner.append(front, back);
        shell.append(inner);
        col.append(shell);
        cardsRow.append(col);
      });
    }

    /* =========================
       Placeholder API fetchers
       ========================= */
    async function mockApiFetchA(){
      await new Promise(res => setTimeout(res, 350)); // pretend network
      return { data: makeTen() };
    }
    async function mockApiFetchB(){
      await new Promise(res => setTimeout(res, 500)); // pretend slower network
      return { data: makeTen() };
    }

    /* =========================
       Multiplication tables (1..12)
       ========================= */
    function renderTables(){
      const host = document.getElementById('tables');
      host.innerHTML = '';
      for(let t=1;t<=12;t++){
        const col = document.createElement('div');
        col.className = 'col-12 col-sm-6 col-lg-4';
        const card = document.createElement('div');
        card.className = 'card h-100';
        const body = document.createElement('div');
        body.className = 'card-body';
        const h = document.createElement('h5');
        h.className = 'card-title';
        h.textContent = `Ã— ${t} Table`;
        const ul = document.createElement('ul');
        ul.className = 'list-unstyled small mb-0';
        for(let i=1;i<=12;i++){
          const li = document.createElement('li');
          li.textContent = `${i} Ã— ${t} = ${i*t}`;
          ul.appendChild(li);
        }
        body.append(h, ul);
        card.append(body);
        col.append(card);
        host.append(col);
      }
    }

    /* =========================
       Wire up controls
       ========================= */
    const regenBtn = document.getElementById('regenBtn');
    const printBtn = document.getElementById('printBtn');
    const apiBtnA = document.getElementById('apiBtnA');
    const apiBtnB = document.getElementById('apiBtnB');

    regenBtn.addEventListener('click', ()=>{
      questions = makeTen();
      renderCards();
      window.scrollTo({top: 0, behavior:'smooth'});
    });

    apiBtnA.addEventListener('click', async ()=>{
      const res = await mockApiFetchA();
      questions = res.data;
      renderCards();
      document.getElementById('apiRow').style.display = 'block';
      window.scrollTo({top: 0, behavior:'smooth'});
    });

    apiBtnB.addEventListener('click', async ()=>{
      const res = await mockApiFetchB();
      questions = res.data;
      renderCards();
      document.getElementById('apiRow').style.display = 'block';
      window.scrollTo({top: 0, behavior:'smooth'});
    });

    printBtn.addEventListener('click', ()=> window.print());

    document.getElementById('playAgainBtn').addEventListener('click', ()=>{
      questions = makeTen();
      renderCards();
      window.scrollTo({top: 0, behavior:'smooth'});
    });

    /* =========================
       Init
       ========================= */
    refreshHighBadge();
    renderTables();
    questions = makeTen();
    renderCards();
  </script>
</body>
</html>
